<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- âœ… Content Security Policy - é˜²ç¦¦ XSS æ”»æ“Šï¼ˆå¼·åŒ–ç‰ˆæœ¬ï¼šç§»é™¤ script-src çš„ unsafe-inlineï¼‰ -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://cdn.tailwindcss.com https://script.googleusercontent.com;
        style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com;
        img-src 'self' data: https:;
        font-src 'self' data:;
        connect-src 'self' https://script.google.com https://script.googleusercontent.com https://generativelanguage.googleapis.com https://sheets.googleapis.com;
        base-uri 'self';
        form-action 'self';"
    >
    <title>Atomic Task Matrix</title>
    <!-- âš ï¸ Tailwind CDN ä¸æ”¯æŒ SRIï¼ˆéœ€è¦ CORS ä½† CDN ä¸å…è¨±ï¼‰ -->
    <!-- å»ºè­°ï¼šåœ¨ç”Ÿç”¢ç’°å¢ƒæ”¹ç”¨è‡ªè¨—ç®¡ Tailwind æˆ–æ”¯æŒ SRI çš„ CDN -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <!-- âœ… Tailwind é…ç½®å·²ç§»è‡³å¤–éƒ¨æª”æ¡ˆï¼ˆtailwind-config.jsï¼‰ï¼Œç¬¦åˆ CSP å®‰å…¨æ”¿ç­– -->
    <script src="tailwind-config.js"></script>

    <!-- âœ… Memphis Design System - CSS Variables + Global Styles -->
    <style>
        /* Memphis Design System Variables */
        :root {
            --primary: #FF6B9D;
            --secondary: #FFA502;
            --tertiary: #C44569;
            --accent1: #26DE81;
            --accent2: #00D2FC;
            --dark: #2D2D2D;
            --light: #FFF9E6;
        }

        /* ç¢ºä¿ HTML å’Œ Body æ­£ç¢ºå¡«æ»¿è¦–å£ */
        html {
            height: 100%;
        }

        /* Memphis èƒŒæ™¯æ¼¸å±¤ - å›ºå®šåœ¨è¦–å£é¿å…æ‹–æ‹½éœ²åº• */
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #FFF9E6 0%, #FFE6F0 100%);
            background-attachment: fixed;
            background-repeat: no-repeat;
        }

        /* Memphis æ—‹è½‰ç³»çµ± - å·²ç¦ç”¨ï¼ˆæ”¹ç‚ºæ°´å¹³æ”¾ç½®ï¼‰ */
        .memphis-rotate-left { transform: rotate(0deg); }
        .memphis-rotate-right { transform: rotate(0deg); }
        .memphis-rotate-slight-left { transform: rotate(0deg); }
        .memphis-rotate-slight-right { transform: rotate(0deg); }

        /* Memphis æ–œé«”æ–‡å­— */
        .italic-bold {
            font-style: italic;
            font-weight: 700;
        }

        /* Memphis æ¨™é¡Œé™°å½± */
        .memphis-title-shadow {
            text-shadow: 3px 3px 0 var(--secondary), 6px 6px 0 var(--accent2);
        }

        /* Memphis æŒ‰éˆ• hover æ•ˆæœ */
        .memphis-btn-hover:hover {
            transform: rotate(0deg) scale(1.05);
        }

        /* Memphis å¹¾ä½•è£é£¾ */
        .geometric-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #2D2D2D;
        }

        .geometric-square {
            width: 60px;
            height: 60px;
            border: 3px solid #2D2D2D;
            transform: rotate(45deg);
        }
    </style>
</head>
<body class="min-h-screen bg-base-bg text-base-text">
    <div class="flex min-h-screen flex-col">
        <header class="border-t-[5px] border-t-dashed border-t-[#FF6B9D] border-b-[5px] border-b-dashed border-b-[#FFA502] bg-white">
            <div class="mx-auto flex w-full max-w-6xl flex-col gap-5 px-6 py-6">
                <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
                    <div class="flex items-center gap-3 rounded-[30px] border-4 border-[#2D2D2D] bg-white px-4 py-3 shadow-memphis-card memphis-rotate-left">
                        <span id="status-indicator" class="text-lg">ğŸ”´</span>
                        <div class="flex flex-col leading-tight">
                            <span id="status-text" class="text-sm text-brand-danger">å°šæœªé€£ç·š</span>
                            <span id="last-sync" class="text-xs text-base-subtle">æœ€å¾ŒåŒæ­¥: -</span>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col gap-4 md:flex-row md:items-start md:justify-between">
                    <div class="flex items-center gap-4">
                        <span class="inline-flex h-12 w-12 items-center justify-center rounded-[20px] border-4 border-[#2D2D2D] bg-white text-2xl shadow-memphis-card memphis-rotate-left">âš›ï¸</span>
                        <div class="space-y-1">
                            <h1 class="text-4xl font-black tracking-tighter text-[#FF6B9D] memphis-title-shadow">Atomic Task Matrix</h1>
                            <p class="text-lg italic-bold text-[#FFA502]">å®Œæˆæ¯”å®Œç¾é‡è¦</p>
                        </div>
                    </div>
                    <div class="flex w-full flex-col gap-3 sm:flex-row sm:items-center sm:justify-end">
                        <label class="relative flex flex-1 items-center">
                            <span class="absolute left-4 text-sm text-[#2D2D2D]">âŒ˜K</span>
                            <input
                                type="search"
                                placeholder="æœå°‹æˆ–æŒ‡ä»¤â€¦"
                                class="w-full rounded-[20px] border-4 border-[#2D2D2D] bg-white px-12 py-3 text-sm font-bold text-[#2D2D2D] shadow-memphis-task outline-none transition focus:shadow-memphis-ring"
                            >
                        </label>
                        <div class="flex items-center gap-2">
                            <button type="button" class="rounded-xl border-3 border-[#2D2D2D] bg-white px-4 py-2 text-xs font-bold text-[#2D2D2D] shadow-memphis-btn transition memphis-btn-hover">äº®/æš—</button>
                            <button type="button" class="rounded-xl border-3 border-[#2D2D2D] bg-white px-4 py-2 text-xs font-bold text-[#2D2D2D] shadow-memphis-btn transition memphis-btn-hover">è¨­å®š</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-1">
            <section class="mx-auto w-full max-w-6xl space-y-6 px-6 py-8">
                <div class="rounded-[30px] border-4 border-[#2D2D2D] bg-white p-6 shadow-memphis-card memphis-rotate-right">
                    <form id="task-form" class="flex flex-col gap-4 lg:flex-row lg:items-center">
                        <div class="w-full lg:flex-1">
                            <label for="task-input" class="sr-only">å»ºç«‹æ–°ä»»å‹™</label>
                            <div class="relative">
                                <span class="pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-[#FF6B9D] font-bold text-lg">+</span>
                                <input
                                    id="task-input"
                                    type="text"
                                    placeholder="è¼¸å…¥ä»»å‹™â€¦"
                                    class="w-full rounded-[20px] border-4 border-[#2D2D2D] bg-white px-11 py-4 text-lg font-bold text-[#2D2D2D] shadow-memphis-task outline-none transition focus:shadow-memphis-ring"
                                    autocomplete="off"
                                >
                            </div>
                        </div>
                        <div class="flex flex-wrap items-center gap-3">
                            <button
                                type="submit"
                                class="rounded-[20px] border-3 border-[#2D2D2D] bg-[#FF6B9D] px-6 py-4 font-bold text-white shadow-memphis-btn transition memphis-rotate-slight-left memphis-btn-hover"
                            >
                                å»ºç«‹ä»»å‹™
                            </button>
                            <div class="flex items-center gap-2 text-xs text-base-subtle">
                                <span class="rounded-lg bg-base-bg px-2 py-1 font-medium text-brand-primary shadow-sm">/ai</span>
                                <span>å‘¼å«åŸå­æ‹†è§£</span>
                                <span class="rounded-lg bg-base-bg px-2 py-1 font-medium text-brand-primary shadow-sm">/due</span>
                                <span>è¨­å®šæˆªæ­¢</span>
                            </div>
                        </div>
                    </form>
                    <p id="task-feedback" class="mt-3 text-sm text-brand-accent opacity-0 transition-opacity duration-200">ä»»å‹™æ–°å¢æˆåŠŸ</p>
                </div>

                <div class="grid gap-6 lg:grid-cols-[minmax(0,7fr)_minmax(0,5fr)]">
                    <section class="space-y-6">
                        <div class="rounded-[30px] border-4 border-[#2D2D2D] bg-white p-6 shadow-memphis-card memphis-rotate-left">
                            <div class="flex items-center justify-between gap-4">
                                <div>
                                    <h2 class="text-2xl font-black text-[#FF6B9D]">ğŸ“¥ å¾…åˆ†é¡å€</h2>
                                    <p class="text-sm italic-bold text-[#FFA502]">æ–°ä»»å‹™å…ˆé€²ä¾†ï¼Œå†æ…¢æ…¢åˆ†é¡ï¼</p>
                                </div>
                                <span class="rounded-[20px] border-3 border-[#2D2D2D] bg-white px-3 py-2 text-xs font-bold text-[#2D2D2D] shadow-memphis-btn">æ‹–æ›³åˆ†é¡</span>
                            </div>
                            <div
                                id="uncategorized-dropzone"
                                data-status="uncategorized"
                                class="mt-4 min-h-[120px] space-y-3 rounded-[20px] border-4 border-dashed border-[#2D2D2D] bg-[#FFF9E6] p-4 transition"
                            >
                                <p class="text-sm text-base-subtle">ç›®å‰æ²’æœ‰ä»»å‹™ï¼Œé€éå‘½ä»¤åˆ—åŠ å…¥ç¬¬ä¸€å€‹è¡Œå‹•ã€‚</p>
                            </div>
                        </div>

                        <div class="grid gap-6 lg:grid-cols-2">
                            <article class="flex flex-col gap-3 rounded-[25px] border-5 border-[#FF6B6B] bg-[#FFE6E6] p-5 shadow-memphis-card memphis-rotate-slight-left">
                                <header class="flex items-start justify-between">
                                    <div>
                                        <h3 class="text-xl font-black text-[#FF6B6B]">ğŸ”¥ é‡è¦ä¸”ç·Šæ€¥</h3>
                                        <p class="text-sm italic-bold text-[#C44569]">ç«‹å³è™•ç†ï¼åˆ¥æ‹–å»¶</p>
                                    </div>
                                    <span class="rounded-[15px] border-3 border-[#2D2D2D] bg-white px-2 py-1 text-[10px] font-bold text-[#FF6B6B]" id="badge-q1">0 é …</span>
                                </header>
                                <div
                                    id="quadrant-q1"
                                    data-status="urgent_important"
                                    class="quadrant-dropzone min-h-[180px] space-y-3 rounded-xl border-4 border-dashed border-[#FF6B6B]/40 bg-white p-3"
                                >
                                    <p class="text-xs text-rose-400">æ‹–æ›³ä»»å‹™æˆ–ä½¿ç”¨ Shift+â†‘ ç§»å‹•åˆ°æ­¤</p>
                                </div>
                            </article>

                            <article class="flex flex-col gap-3 rounded-[25px] border-5 border-[#26DE81] bg-[#E6F9F0] p-5 shadow-memphis-card memphis-rotate-slight-right">
                                <header class="flex items-start justify-between">
                                    <div>
                                        <h3 class="text-xl font-black text-[#26DE81]">âœ¨ é‡è¦ä¸ç·Šæ€¥</h3>
                                        <p class="text-sm italic-bold text-[#0FA060]">ç©©å®šæ¨é€²ï¼Œæ…¢å·¥å‡ºç´°æ´»</p>
                                    </div>
                                    <span class="rounded-[15px] border-3 border-[#2D2D2D] bg-white px-2 py-1 text-[10px] font-bold text-[#26DE81]" id="badge-q2">0 é …</span>
                                </header>
                                <div
                                    id="quadrant-q2"
                                    data-status="not_urgent_important"
                                    class="quadrant-dropzone min-h-[180px] space-y-3 rounded-xl border-4 border-dashed border-[#26DE81]/40 bg-white p-3"
                                >
                                    <p class="text-xs text-emerald-500">æ‹–æ›³ä»»å‹™æˆ–ä½¿ç”¨ Shift+â†’ ç§»å‹•åˆ°æ­¤</p>
                                </div>
                            </article>

                            <article class="flex flex-col gap-3 rounded-[25px] border-5 border-[#FFA502] bg-[#FFE6CC] p-5 shadow-memphis-card memphis-rotate-slight-left">
                                <header class="flex items-start justify-between">
                                    <div>
                                        <h3 class="text-xl font-black text-[#FFA502]">â° ç·Šæ€¥ä¸é‡è¦</h3>
                                        <p class="text-sm italic-bold text-[#CC7700]">å¯ä»¥å§”æ´¾æˆ–å»¶å¾Œ</p>
                                    </div>
                                    <span class="rounded-[15px] border-3 border-[#2D2D2D] bg-white px-2 py-1 text-[10px] font-bold text-[#FFA502]" id="badge-q3">0 é …</span>
                                </header>
                                <div
                                    id="quadrant-q3"
                                    data-status="urgent_not_important"
                                    class="quadrant-dropzone min-h-[180px] space-y-3 rounded-xl border-4 border-dashed border-[#FFA502]/40 bg-white p-3"
                                >
                                    <p class="text-xs text-amber-500">æ‹–æ›³ä»»å‹™æˆ–ä½¿ç”¨ Shift+â† ç§»å‹•åˆ°æ­¤</p>
                                </div>
                            </article>

                            <article class="flex flex-col gap-3 rounded-[25px] border-5 border-[#00D2FC] bg-[#E6F2FF] p-5 shadow-memphis-card memphis-rotate-slight-right">
                                <header class="flex items-start justify-between">
                                    <div>
                                        <h3 class="text-xl font-black text-[#00D2FC]">ğŸ¯ ä¸ç·Šæ€¥ä¸é‡è¦</h3>
                                        <p class="text-sm italic-bold text-[#0099CC]">æœ‰ç©ºå†åšæˆ–ç›´æ¥åˆªé™¤</p>
                                    </div>
                                    <span class="rounded-[15px] border-3 border-[#2D2D2D] bg-white px-2 py-1 text-[10px] font-bold text-[#00D2FC]" id="badge-q4">0 é …</span>
                                </header>
                                <div
                                    id="quadrant-q4"
                                    data-status="not_urgent_not_important"
                                    class="quadrant-dropzone min-h-[180px] space-y-3 rounded-xl border-4 border-dashed border-[#00D2FC]/40 bg-white p-3"
                                >
                                    <p class="text-xs text-slate-500">æ‹–æ›³ä»»å‹™æˆ–ä½¿ç”¨ Shift+â†“ ç§»å‹•åˆ°æ­¤</p>
                                </div>
                            </article>
                        </div>
                    </section>

                    <aside class="space-y-6">
                        <div class="rounded-[30px] border-4 border-[#2D2D2D] bg-white p-6 shadow-memphis-card memphis-rotate-left">
                            <div class="flex items-center justify-between">
                                <h2 class="text-2xl font-black text-[#FF6B9D]">ğŸ“Š æœ¬é€±å‹•èƒ½</h2>
                                <button id="refresh-stats" class="text-xs font-bold text-[#FFA502] underline-offset-2 hover:underline">é‡æ–°æ•´ç†</button>
                            </div>
                            <div class="mt-4 flex flex-col gap-6 sm:flex-row sm:items-center">
                                <div class="relative flex items-center justify-center">
                                    <svg id="progress-ring" width="140" height="140" viewBox="0 0 120 120" class="drop-shadow-lg">
                                        <circle cx="60" cy="60" r="50" stroke="rgba(238,238,238,0.5)" stroke-width="10" fill="none" />
                                        <circle id="progress-ring-circle" cx="60" cy="60" r="50" stroke="#FF6B9D" stroke-width="10" fill="none" stroke-linecap="round" stroke-dasharray="314" stroke-dashoffset="314" class="transition-all duration-500 ease-out" />
                                    </svg>
                                    <div class="pointer-events-none absolute inset-0 flex flex-col items-center justify-center text-center">
                                        <span id="progress-ring-value" class="text-3xl font-semibold text-brand-primary">--%</span>
                                        <span class="text-xs text-base-subtle">å®Œæˆç‡</span>
                                    </div>
                                </div>
                                <div class="flex-1 space-y-3 text-sm">
                                    <div>
                                        <p class="text-xs text-base-subtle">æœ¬é€±å®Œæˆä»»å‹™</p>
                                        <p id="stat-total-completed" class="text-lg font-semibold text-base-text">--</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-base-subtle">å¹³å‡å­˜æ´»æ—¥</p>
                                        <p id="stat-avg-lifetime" class="text-lg font-semibold text-base-text">-- å¤©</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-base-subtle">æ‹†è§£æ¡ç´ç‡</p>
                                        <p id="stat-adoption" class="text-lg font-semibold text-base-text">--%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </aside>
                </div>
            </section>
        </main>

        <footer class="border-t-4 border-[#2D2D2D] bg-white">
            <div class="mx-auto flex w-full max-w-6xl flex-wrap items-center justify-between gap-3 px-6 py-4">
                <span class="italic-bold font-bold text-[#FF6B9D]">Atomic Task Matrix Â· Memphis Design Â© 2025</span>
                <span class="italic-bold text-sm text-[#FFA502]">å¤§è†½å‰µæ„ Ã— é«˜æ•ˆåŸ·è¡Œ</span>
            </div>
        </footer>
    </div>

    <template id="task-card-template">
        <article class="task-card group relative rounded-[20px] border-4 border-[#2D2D2D] bg-white p-4 text-sm text-[#2D2D2D] shadow-memphis-task transition memphis-rotate-slight-left hover:shadow-memphis-card"
            draggable="true">
            <div class="absolute inset-x-0 top-0 h-1 w-full -translate-y-full bg-[#FF6B9D]/30 opacity-0 transition duration-200 group-hover:translate-y-0 group-hover:opacity-100 rounded-t-[20px]"></div>
            <div class="flex items-start justify-between gap-3">
                <div class="space-y-1">
                    <p class="font-bold leading-snug"></p>
                    <p class="text-xs text-[#757575]"></p>
                </div>
                <div class="flex flex-col gap-2 text-xs">
                    <button
                        data-action="breakdown"
                        class="inline-flex items-center justify-center gap-1.5 rounded-xl border-3 border-[#2D2D2D] bg-[#FFA502] text-white font-bold px-2 py-1 transition shadow-memphis-btn memphis-btn-hover"
                        title="AI æ‹†è§£"
                    >
                        <!-- Heroicons: sparkles -->
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                        </svg>
                        AI
                    </button>
                    <button data-action="complete" class="rounded-xl border-3 border-[#2D2D2D] bg-[#26DE81] text-white font-bold px-2 py-1 transition shadow-memphis-btn memphis-btn-hover">å®Œæˆ</button>
                    <button data-action="delete" class="rounded-xl border-3 border-[#2D2D2D] bg-[#FF6B6B] text-white font-bold px-2 py-1 transition shadow-memphis-btn memphis-btn-hover">åˆªé™¤</button>
                </div>
            </div>
            <div class="mt-3 space-y-2">
                <div class="flex items-center justify-between text-xs text-base-subtle">
                    <span class="inline-flex items-center gap-1">
                        <span class="h-1.5 w-1.5 rounded-full bg-brand-accent"></span>
                        <span class="status-label"></span>
                    </span>
                </div>
                <div class="space-y-0.5 text-[11px] text-base-subtle/80">
                    <div class="flex items-center gap-2">
                        <span class="created-at"></span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="updated-at"></span>
                    </div>
                    <div class="completed-at-wrapper hidden">
                        <span class="completed-at"></span>
                    </div>
                </div>
            </div>
        </article>
    </template>

    <script src="config.js"></script>

    <!-- ========== Atomic Task Matrix - æ¨¡çµ„è¼‰å…¥ ========== -->

    <!-- Layer 1: åŸºç¤å±¤ï¼ˆç„¡ä¾è³´ï¼‰ -->
    <script src="core/constants.js"></script>
    <script src="core/icons.js"></script>
    <script src="models/Task.js"></script>

    <!-- Layer 2: é…ç½®èˆ‡ç‹€æ…‹å±¤ -->
    <script src="core/config.js"></script>
    <script src="core/state.js"></script>

    <!-- Layer 3: æœå‹™å±¤ -->
    <script src="services/BackendGateway.js"></script>

    <!-- Layer 4: æ¥­å‹™é‚è¼¯å±¤ -->
    <script src="handlers/DragDropHandler.js"></script>
    <script src="ui/FeedbackToast.js"></script>
    <script src="ui/Renderer.js"></script>
    <script src="ui/ConfirmDialog.js"></script>
    <script src="managers/TaskManager.js"></script>
    <script src="monitors/ConnectionMonitor.js"></script>

    <!-- Layer 5: æ‡‰ç”¨å±¤ -->
    <script src="app/events.js"></script>
    <script src="app/bootstrap.js"></script>
</body>
</html>
